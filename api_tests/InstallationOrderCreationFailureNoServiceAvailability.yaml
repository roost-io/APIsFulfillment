# ********RoostGPT********

# Test generated by RoostGPT for test dm-vtal using AI Type Claude AI and AI Model claude-3-5-sonnet-20240620
# 
# ROOST_METHOD_HASH=94cf0559d6
# ROOST_METHOD_SIG_HASH=04b6a89eb6
# 
#    ########## Scenario ##########  
# 
# {
#   feature: 'Feature: Installation Order Processing',
#   background: null,
#   rule: null,
#   scenario: {
#     title: 'Scenario: Installation Order Creation Failure due to No Service Availability',
#     steps: 'Given the user has a valid geographic address\n' +
#       'When the user retrieves the address details using the Geographic Address Management API\n' +
#       'And the user retrieves the address complements using the Geographic Address Management API\n' +
#       'And the user checks the service availability for the address using the Resource Pool Management API\n' +
#       'And the service is not available for the address\n' +
#       'Then the installation order creation should fail\n' +
#       'And an appropriate error message should be provided indicating no service availability\n' +
#       '\n' +
#       '# High-level description of the expected behavior for each scenario:\n' +
#       '# \n' +
#       '# Successful Installation Order Creation:\n' +
#       '# \n' +
#       '# The user provides a valid geographic address.\n' +
#       '# The address details and complements are retrieved using the Geographic Address Management API.\n' +
#       '# The service availability is checked for the address using the Resource Pool Management API.\n' +
#       '# If the service is available, the user proceeds to search for available appointment slots using the Appointment API.\n' +
#       '# The user selects a suitable appointment slot and creates an appointment using the Appointment API.\n' +
#       '# The user places an installation order with the appointment details using the ProductOrdering API.\n' +
#       '# The installation order should be created successfully and associated with the selected appointment.\n' +
#       '# \n' +
#       '# \n' +
#       '# Installation Order Creation with Partial Service Availability:\n' +
#       '# \n' +
#       '# Similar to the successful scenario, but the service availability check indicates partial availability for the address.\n' +
#       '# The user proceeds with the appointment booking and order placement.\n' +
#       '# The installation order should be created successfully, associated with the selected appointment, and indicate partial service availability.\n' +
#       '# \n' +
#       '# \n' +
#       '# Installation Order Creation Failure due to No Service Availability:\n' +
#       '# \n' +
#       '# The user provides a valid geographic address.\n' +
#       '# The address details and complements are retrieved using the Geographic Address Management API.\n' +
#       '# The service availability is checked for the address using the Resource Pool Management API.\n' +
#       '# If the service is not available for the address, the installation order creation should fail.\n' +
#       '# An appropriate error message should be provided to the user indicating that the service is not available for the given address.\n' +
#       '# \n' +
#       '# \n' +
#       '# \n' +
#       '# These scenarios cover the main paths of the installation order creation process based on the provided API flow diagram, considering different service availability scenarios.',
#     examples: ''
#   }
# }
# 

# ********RoostGPT********
config:
  target: '{{ $processEnvironment.API_HOST }}'
  phases:
    - duration: 1
      arrivalRate: 1
  payload:
    path: '{{ROOST_CSV_FILE_NAME}}'
    fields:
      - addressId
    skipHeader: true
  delimiter: ^|^
scenarios:
  - name: Installation Order Creation Failure due to No Service Availability
    flow:
      - get:
          url: >-
            {{ $processEnvironment.API_HOST_2 }}/geographicAddress/{{ addressId
            }}
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
          capture:
            - json: $.address.id
              as: capturedAddressId
          expect:
            - statusCode: 200
            - hasProperty: address
            - hasProperty: address.id
      - get:
          url: >-
            {{ $processEnvironment.API_HOST_2 }}/addressComplements/{{
            capturedAddressId }}
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
          expect:
            - statusCode: 200
            - hasProperty: complementList
      - post:
          url: '{{ $processEnvironment.API_HOST_3 }}/productOrder'
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
            Content-Type: application/json
          json:
            order:
              addresses:
                address:
                  id: '{{ capturedAddressId }}'
              associatedDocument: VTT001
              associatedDocumentDate: '2023-06-09T18:20:53-03:00'
              correlationOrder: '10'
              customer:
                businessUnity: varejo
                fantasyName: InterHome Internet
                name: Sandbox V.tal
                phoneNumber:
                  phoneNumbers:
                    - '21999999999'
                    - ''
                    - ''
                subscriberId: SVTAL001
                workContact:
                  email: sindicovtal@vtal.com
                  name: sindico Vtal
                  phone: '21999900000'
              infraType: FTTH
              products:
                product:
                  - action: adicionar
                    catalogId: BL_200MB
              type: Instalacao
          expect:
            - statusCode: 406
            - hasProperty: control
            - hasProperty: control.code
            - hasProperty: control.message
            - hasProperty: control.type
            - equals:
                - '{{ control.type }}'
                - E
