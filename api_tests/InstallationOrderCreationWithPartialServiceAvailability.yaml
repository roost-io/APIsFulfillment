# ********RoostGPT********

# Test generated by RoostGPT for test dm-vtal using AI Type Claude AI and AI Model claude-3-5-sonnet-20240620
# 
# ROOST_METHOD_HASH=1c974c8238
# ROOST_METHOD_SIG_HASH=fb8a25e157
# 
#    ########## Scenario ##########  
# 
# {
#   feature: 'Feature: Installation Order Processing',
#   background: null,
#   rule: null,
#   scenario: {
#     title: 'Scenario: Installation Order Creation with Partial Service Availability',
#     steps: 'Given the user has a valid geographic address\n' +
#       'When the user retrieves the address details using the Geographic Address Management API\n' +
#       'And the user retrieves the address complements using the Geographic Address Management API\n' +
#       'And the user checks the service availability for the address using the Resource Pool Management API\n' +
#       'And the service is partially available for the address\n' +
#       'And the user searches for available appointment slots using the Appointment API\n' +
#       'And selects a suitable appointment slot\n' +
#       'And creates an appointment with the selected slot using the Appointment API\n' +
#       'And places an installation order with the appointment details using the ProductOrdering API\n' +
#       'Then the installation order should be created successfully\n' +
#       'And the order should be associated with the selected appointment\n' +
#       'And the order should indicate partial service availability',
#     examples: ''
#   }
# }
# 

# ********RoostGPT********
config:
  target: '{{ $processEnvironment.API_HOST }}'
  phases:
    - duration: 1
      arrivalRate: 1
  payload:
    path: '{{ROOST_CSV_FILE_NAME}}'
    fields:
      - addressId
      - complementId
      - appointmentId
    skipHeader: true
  delimiter: ^|^
scenarios:
  - name: Installation Order Creation with Partial Service Availability
    flow:
      - get:
          url: >-
            {{ $processEnvironment.API_HOST_2 }}/geographicAddress/{{ addressId
            }}
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
          capture:
            - json: $.address.id
              as: capturedAddressId
          expect:
            - statusCode: 200
            - hasProperty: address
      - get:
          url: >-
            {{ $processEnvironment.API_HOST_2 }}/addressComplements/{{
            capturedAddressId }}
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
          capture:
            - json: $.complementList[0].id
              as: capturedComplementId
          expect:
            - statusCode: 200
            - hasProperty: complementList
      - get:
          url: >-
            /searchTimeSlot?addressId={{ capturedAddressId
            }}&associatedDocument=VTT001&startDate=2023-05-01T00:00:00&finishDate=2023-05-14T23:59:59&orderType=Instalacao&productType=Banda%20Larga
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
          capture:
            - json: $.slots[0].id
              as: capturedSlotId
          expect:
            - statusCode: 200
            - hasProperty: slots
      - post:
          url: '{{ $processEnvironment.API_HOST_0 }}/appointment'
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
            Content-Type: application/json
          json:
            appointment:
              reason: Agendamento para Instalação de Fibra
              slot:
                id: '{{ capturedSlotId }}'
          capture:
            - json: $.appointment.id
              as: capturedAppointmentId
          expect:
            - statusCode: 201
            - hasProperty: appointment.id
      - post:
          url: '{{ $processEnvironment.API_HOST_3 }}/productOrder'
          headers:
            Authorization: '{{ $processEnvironment.AUTH_TOKEN }}'
            Content-Type: application/json
          json:
            order:
              addresses:
                address:
                  complement:
                    complements:
                      - type: ES
                        value: ARC201
                  id: '{{ capturedAddressId }}'
                  inventoryId: '1766156'
                  reference: Do lado da padaria
              appointment:
                date: '{{ $formatDate($now, ''YYYY-MM-DDTHH:mm:ss'') }}'
                hasSlot: true
                mandatoryType: Obrigatorio
                workOrderId: '{{ capturedAppointmentId }}'
              associatedDocument: VTT001
              associatedDocumentDate: '{{ $formatDate($now, ''YYYY-MM-DDTHH:mm:ssZ'') }}'
              correlationOrder: '9'
              customer:
                businessUnity: varejo
                fantasyName: InterHome Internet
                name: Sandbox V.tal
                phoneNumber:
                  phoneNumbers:
                    - '21999999999'
                    - '11900000009'
                    - ''
                subscriberId: SVTAL001
                workContact:
                  email: sindicovtal@vtal.com
                  name: sindico Vtal
                  phone: '21999900000'
              infraType: FTTH
              products:
                product:
                  - action: adicionar
                    catalogId: BL_200MB
              type: Instalacao
          expect:
            - statusCode: 201
            - hasProperty: order.id
