# ********RoostGPT********

# Test generated by RoostGPT for test vtal-product-order using AI Type Claude AI and AI Model claude-3-opus-20240229
# 
# Feature file generated for /listener/productOrderStateChangeEvent_post for http method type POST 
# RoostTestHash=6f5fd9fdba
# 
# 

# ********RoostGPT********
Feature: Test /listener/productOrderStateChangeEvent endpoint

  Background:
    * def urlBase = karate.properties['url.base'] || karate.get('urlBase', 'http://localhost:4010')
    * url urlBase
    * def authToken = karate.properties['AUTH_TOKEN']
    * configure headers = { 'Authorization': '#(authToken)' }

  Scenario Outline: Test successful closing notification
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {
        "notification": {
          "date": "<date>",
          "customer": {
            "subscriberId": "<subscriberId>"
          },
          "order": {
            "id": "<orderId>",
            "correlationOrder": "<correlationOrder>",
            "associatedDocument": "<associatedDocument>",
            "type": "Encerramento",
            "code": "0",
            "description": "Ordem encerrada com sucesso.",
            "lostEquipment": <lostEquipment>,
            "resource": {
              "gponAccess": "<gponAccess>",
              "fiberPath": {
                "items": {
                  "item": [
                    {
                      "name": "enderecoCDO",
                      "value": "RUA GENERAL RENATO PAQUET, 199, BARRA DA TIJUCA, RIO DE JANEIRO - RJ 22793913"
                    },
                    {
                      "name": "producer_olt", 
                      "value": "HUAWEI"
                    },
                    {
                      "name": "CDO",
                      "value": "CDOI-4704-PTP.FO.O:45"
                    },
                    {
                      "name": "CDO",
                      "value": "CDOI-4704-PTP.FO.I:S32_2_IN 1"
                    },
                    {
                      "name": "estacao",
                      "value": "BEL"
                    },
                    {
                      "name": "cnl",
                      "value": "CBF"
                    },
                    {
                      "name": "olt",
                      "value": "MA-CTO04-GHUA"
                    },
                    {
                      "name": "primaryCable",
                      "value": "MA.CTO.F-7.CEO-15/1"
                    },
                    {
                      "name": "secondaryCable",
                      "value": "MA.CTO.F-7.CEOS-165"  
                    }
                  ]
                }
              }
            }
          }
        }
      }
      """
    When method POST
    Then status 204

    Examples:
      | read('listener_productOrderStateChangeEvent_post.csv') |

  Scenario: Test cancel notification
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {
        "notification": {
          "date": "2021-09-29T18:42:24.641-03:00",
          "customer": {
            "subscriberId": "234567654"
          },
          "order": {
            "id": "20230315000001",
            "correlationOrder": "10",
            "associatedDocument": "VTT001",
            "type": "Cancelamento",
            "code": "2",
            "description": "Ordem cancelada"
          }
        }
      }
      """
    When method POST
    Then status 204

  Scenario: Test ONT already in use notification
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {
        "notification": {
          "date": "2021-10-26T17:53:25.497-03:00",
          "customer": {
            "subscriberId": "234567654"
          },
          "order": {
            "id": "20230315000001",
            "correlationOrder": "10",
            "associatedDocument": "VTT001",
            "type": "Encerramento",
            "code": "-1",
            "description": "O Equipamento já está em uso por outro cliente",
            "lostEquipment": true,
            "resource": {
              "fiberPath": {
                "items": ""
              }
            }
          }
        }
      }
      """
    When method POST
    Then status 204

  Scenario: Test closing notification with ontOwner Vtal - Install
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {
        "notification": {
          "date": "2022-12-26T12:15:35.174-03:00",
          "customer": {
            "subscriberId": "234567654"
          },
          "order": {
            "id": "20230315000001",
            "correlationOrder": "10",
            "associatedDocument": "VTT001",
            "type": "Encerramento",
            "code": "0",
            "description": "BA de campo encerrado com sucesso",
            "resource": {
              "gponAccess": "A000009QS",
              "devices": {
                "device": [
                  {
                    "category": "ONT",
                    "type": "PhsysicalResource",
                    "description": "Equipment - ONT device",
                    "state": "completed",
                    "usageState": "active",
                    "startOperatingDate": "2022-12-26T12:15:35.174-03:00",
                    "resourceCharacteristic": [
                      {
                        "name": "serialNumber",
                        "value": "0251990119989"
                      },
                      {
                        "name": "firmware",
                        "value": "FW-XPTO-123"
                      },
                      {
                        "name": "manufacturer",
                        "value": "Sagemcom"
                      },
                      {
                        "name": "model",
                        "value": "F@ST 5340 TFN"
                      }
                    ]
                  }
                ]
              },
              "fiberPath": {
                "items": {
                  "item": [
                    {
                      "name": "enderecoCDO",
                      "value": "RUA GENERAL RENATO PAQUET, 199, BARRA DA TIJUCA, RIO DE JANEIRO - RJ 22793913"
                    },
                    {
                      "name": "producer_olt",
                      "value": "HUAWEI"
                    },
                    {
                      "name": "CDO",
                      "value": "CDOI-4704-PTP.FO.O:45"
                    },
                    {
                      "name": "CDO",
                      "value": "CDOI-4704-PTP.FO.I:S32_2_IN 1"
                    },
                    {
                      "name": "estacao",
                      "value": "BEL"
                    },
                    {
                      "name": "cnl",
                      "value": "CBF"
                    },
                    {
                      "name": "olt",
                      "value": "MA-CTO04-GHUA"
                    },
                    {
                      "name": "primaryCable",
                      "value": "MA.CTO.F-7.CEO-15/1"
                    },
                    {
                      "name": "secondaryCable",
                      "value": "MA.CTO.F-7.CEOS-165"
                    }
                  ]
                }
              }
            }
          }
        }
      }
      """
    When method POST
    Then status 204

  Scenario Outline: Test error responses
    Given path '/listener/productOrderStateChangeEvent'
    And request {}
    When method POST
    Then status <responseCode>

    Examples:
      | read('listener_productOrderStateChangeEvent_post.csv') |
